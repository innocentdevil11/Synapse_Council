# Architecture & Data Flow Diagrams

## System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         FRONTEND                                 â”‚
â”‚                    (React/Next.js)                                â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚            AudioRecorder Component                        â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚   â”‚
â”‚  â”‚  â”‚ Web Audio API                                   â”‚     â”‚   â”‚
â”‚  â”‚  â”‚ - Microphone Access                             â”‚     â”‚   â”‚
â”‚  â”‚  â”‚ - Audio Stream Capture                          â”‚     â”‚   â”‚
â”‚  â”‚  â”‚ - 100ms chunk intervals                         â”‚     â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚   â”‚
â”‚  â”‚                       â†“                                    â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚   â”‚
â”‚  â”‚  â”‚ Base64 Encoding                                 â”‚     â”‚   â”‚
â”‚  â”‚  â”‚ - Convert binary to text for JSON               â”‚     â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚   â”‚
â”‚  â”‚                       â†“                                    â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚   â”‚
â”‚  â”‚  â”‚ WebSocket Client                                â”‚     â”‚   â”‚
â”‚  â”‚  â”‚ - Real-time streaming                           â”‚     â”‚   â”‚
â”‚  â”‚  â”‚ - Low-latency communication                     â”‚     â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚            Main Page Component                           â”‚   â”‚
â”‚  â”‚  - Query textarea (manual input)                         â”‚   â”‚
â”‚  â”‚  - Weight sliders (agent influence)                      â”‚   â”‚
â”‚  â”‚  - Decision results display                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
           WebSocket (ws://localhost:8000/ws/*)
           HTTP REST (http://localhost:8000/*)
                             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         BACKEND                                  â”‚
â”‚                       (FastAPI)                                   â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚        WebSocket Endpoints                               â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚   â”‚
â”‚  â”‚  â”‚ /ws/transcribe-live                             â”‚     â”‚   â”‚
â”‚  â”‚  â”‚ - Receive audio chunks                          â”‚     â”‚   â”‚
â”‚  â”‚  â”‚ - Send acknowledgments                          â”‚     â”‚   â”‚
â”‚  â”‚  â”‚ - Return transcription                          â”‚     â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚   â”‚
â”‚  â”‚                       â–²                                    â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚   â”‚
â”‚  â”‚  â”‚ /ws/transcribe-and-decide                       â”‚     â”‚   â”‚
â”‚  â”‚  â”‚ - Receive audio + weights                       â”‚     â”‚   â”‚
â”‚  â”‚  â”‚ - Stream agent responses in real-time           â”‚     â”‚   â”‚
â”‚  â”‚  â”‚ - Send final decision                           â”‚     â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚        Audio Processor Module                             â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚   â”‚
â”‚  â”‚  â”‚ get_whisper_model()                             â”‚     â”‚   â”‚
â”‚  â”‚  â”‚ - Load model (one-time)                         â”‚     â”‚   â”‚
â”‚  â”‚  â”‚ - Cache locally                                 â”‚     â”‚   â”‚
â”‚  â”‚  â”‚ - Models: tiny, base, small, medium, large      â”‚     â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚   â”‚
â”‚  â”‚                       â–²                                    â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚   â”‚
â”‚  â”‚  â”‚ transcribe_audio()                              â”‚     â”‚   â”‚
â”‚  â”‚  â”‚ - Check result cache                            â”‚     â”‚   â”‚
â”‚  â”‚  â”‚ - Run Whisper model                             â”‚     â”‚   â”‚
â”‚  â”‚  â”‚ - Auto-detect language                          â”‚     â”‚   â”‚
â”‚  â”‚  â”‚ - Cache result                                  â”‚     â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚   â”‚
â”‚  â”‚                       â–²                                    â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚   â”‚
â”‚  â”‚  â”‚ transcribe_audio_async()                        â”‚     â”‚   â”‚
â”‚  â”‚  â”‚ - Run in thread pool (non-blocking)             â”‚     â”‚   â”‚
â”‚  â”‚  â”‚ - Async wrapper                                 â”‚     â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚        Multi-Agent System                                 â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚   â”‚
â”‚  â”‚  â”‚ graph.py - LangGraph Workflow                   â”‚     â”‚   â”‚
â”‚  â”‚  â”‚  â”œâ”€ Ethical Agent                              â”‚     â”‚   â”‚
â”‚  â”‚  â”‚  â”œâ”€ Risk & Logic Agent                         â”‚     â”‚   â”‚
â”‚  â”‚  â”‚  â”œâ”€ Emotional Intelligence Agent               â”‚     â”‚   â”‚
â”‚  â”‚  â”‚  â”œâ”€ Values Alignment Agent                     â”‚     â”‚   â”‚
â”‚  â”‚  â”‚  â”œâ”€ Red Team Agent                             â”‚     â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€ Aggregator (Final Decision)                â”‚     â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚   â”‚
â”‚  â”‚  Takes: user query + weights                             â”‚   â”‚
â”‚  â”‚  Returns: Individual perspectives + final decision       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚        REST Endpoints (Optional)                          â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚   â”‚
â”‚  â”‚  â”‚ POST /transcribe                                â”‚     â”‚   â”‚
â”‚  â”‚  â”‚ - File upload transcription                     â”‚     â”‚   â”‚
â”‚  â”‚  â”‚ - Fallback if WebSocket fails                   â”‚     â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚   â”‚
â”‚  â”‚  â”‚ POST /decision                                  â”‚     â”‚   â”‚
â”‚  â”‚  â”‚ - Text-based decision (original)                â”‚     â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚   â”‚
â”‚  â”‚  â”‚ GET /cache-stats, DELETE /cache                â”‚     â”‚   â”‚
â”‚  â”‚  â”‚ - Cache management                              â”‚     â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Flow: "Transcribe & Decide" Path

```
USER SPEAKS
    â”‚
    â–¼
BROWSER CAPTURES AUDIO
    â”‚ (100ms chunks)
    â”‚
    â–¼
WebSocket sends BASE64 ENCODED CHUNKS
    â”‚ (Real-time, low-latency)
    â”‚
    â–¼
BACKEND RECEIVES CHUNKS
    â”‚
    â–¼
ACCUMULATE AUDIO BYTES
    â”‚
    â–¼
SEND "DECIDE" MESSAGE
    â”‚
    â–¼
LOAD WHISPER MODEL (if not cached)
    â”‚ (Downloads once: ~140MB for base model)
    â”‚
    â–¼
TRANSCRIBE AUDIO
    â”‚ (Auto-detects language)
    â”‚
    â”œâ”€â†’ CHECK CACHE (same audio before?)
    â”‚   â””â”€â†’ YES: Return cached result (<1s)
    â”‚   â””â”€â†’ NO: Run Whisper model (5-10s)
    â”‚
    â–¼
SEND "transcribed" MESSAGE TO FRONTEND
    â”‚ (Shows in real-time)
    â”‚
    â–¼
PASS QUERY TO MULTI-AGENT SYSTEM
    â”‚
    â”œâ”€â†’ ETHICAL AGENT ANALYZES â”€â”€â”
    â”‚                              â”‚
    â”œâ”€â†’ RISK AGENT ANALYZES â”€â”€â”€â”€â”€â”€â”¤ (Parallel)
    â”‚                              â”‚
    â”œâ”€â†’ EQ AGENT ANALYZES â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚                              â”‚
    â”œâ”€â†’ VALUES AGENT ANALYZES â”€â”€â”€â”€â”¤
    â”‚                              â”‚
    â”œâ”€â†’ RED TEAM AGENT ANALYZES â”€â”€â”˜
    â”‚
    â–¼
EACH AGENT COMPLETES
    â”‚ (In any order)
    â”‚
    â”œâ”€â†’ SEND "agent_response" MESSAGE
    â”‚   â”œâ”€ Agent: "ethical"
    â”‚   â”œâ”€ Output: "From ethical perspective..."
    â”‚
    â”œâ”€â†’ FRONTEND DISPLAYS IMMEDIATELY
    â”‚
    â–¼
ALL AGENTS COMPLETE
    â”‚
    â–¼
AGGREGATOR CREATES FINAL DECISION
    â”‚
    â–¼
SEND "final_decision" MESSAGE
    â”‚
    â–¼
FRONTEND DISPLAYS FINAL DECISION
    â”‚
    â–¼
WEBSOCKET CLOSES
    â”‚
    â–¼
USER SEES COMPLETE ANALYSIS âœ¨
```

---

## Data Flow: "Transcribe Only" Path

```
USER SPEAKS
    â”‚
    â–¼
BROWSER CAPTURES AUDIO
    â”‚
    â–¼
WebSocket sends AUDIO CHUNKS
    â”‚
    â–¼
BACKEND RECEIVES CHUNKS
    â”‚
    â–¼
TRANSCRIBE with WHISPER
    â”‚
    â”œâ”€â†’ Check cache
    â””â”€â†’ Run model if needed
    â”‚
    â–¼
SEND "transcription" MESSAGE
    â”‚
    â–¼
FRONTEND DISPLAYS TEXT
    â”‚
    â–¼
POPULATE QUERY TEXTAREA
    â”‚
    â–¼
USER ADJUSTS TEXT IF NEEDED
    â”‚
    â–¼
USER CLICKS "Run Synapse Council"
    â”‚
    â–¼
SEND TEXT + WEIGHTS TO /decision ENDPOINT
    â”‚
    â–¼
[REST API PATH - same as text input]
```

---

## Audio Processing Pipeline

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Browser (Frontend)                        â”‚
â”‚                                                              â”‚
â”‚  getUserMedia()                                              â”‚
â”‚       â”‚ (Request microphone access)                         â”‚
â”‚       â–¼                                                      â”‚
â”‚  MediaRecorder                                               â”‚
â”‚       â”‚ (Capture audio stream)                              â”‚
â”‚       â–¼                                                      â”‚
â”‚  Record Chunks (every 100ms)                                â”‚
â”‚       â”‚ (Binary audio data)                                 â”‚
â”‚       â–¼                                                      â”‚
â”‚  Base64 Encode                                               â”‚
â”‚       â”‚ (Convert to JSON-safe format)                       â”‚
â”‚       â–¼                                                      â”‚
â”‚  WebSocket Send                                              â”‚
â”‚       â”‚ (Real-time transmission)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ Network (WebSocket)
        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Backend (Server)                            â”‚
â”‚                                                              â”‚
â”‚  Receive JSON Message                                        â”‚
â”‚       â”‚ ({"type": "audio", "data": "..."})                 â”‚
â”‚       â–¼                                                      â”‚
â”‚  Base64 Decode                                               â”‚
â”‚       â”‚ (Convert back to binary)                            â”‚
â”‚       â–¼                                                      â”‚
â”‚  Accumulate Bytes                                            â”‚
â”‚       â”‚ (Build complete audio)                              â”‚
â”‚       â–¼                                                      â”‚
â”‚  Cache Lookup                                                â”‚
â”‚       â”‚ (Check MD5 hash of audio)                           â”‚
â”‚       â”œâ”€â†’ Cache HIT: Return cached text (<1s)
â”‚       â”‚                                                      â”‚
â”‚       â”œâ”€â†’ Cache MISS:                                       â”‚
â”‚       â”‚       â”‚                                             â”‚
â”‚       â”‚       â–¼                                             â”‚
â”‚       â”‚   Load Whisper Model                                â”‚
â”‚       â”‚       â”‚ (One-time, ~1-2min for first run)          â”‚
â”‚       â”‚       â–¼                                             â”‚
â”‚       â”‚   Model Ready (cached for future)                   â”‚
â”‚       â”‚       â”‚                                             â”‚
â”‚       â”‚       â–¼                                             â”‚
â”‚       â”‚   Run Inference                                      â”‚
â”‚       â”‚       â”‚ (Transcribe audio)                          â”‚
â”‚       â”‚       â–¼                                             â”‚
â”‚       â”‚   Auto-Detect Language                              â”‚
â”‚       â”‚       â”‚                                             â”‚
â”‚       â”‚       â–¼                                             â”‚
â”‚       â”‚   Cache Result                                       â”‚
â”‚       â”‚       â”‚                                             â”‚
â”‚       â–¼       â–¼                                             â”‚
â”‚  Return Transcribed Text                                     â”‚
â”‚       â”‚ (+ language, +/- cache flag)                        â”‚
â”‚       â–¼                                                      â”‚
â”‚  Send Response Message                                       â”‚
â”‚       â”‚ ({"type": "transcription", "text": "..."})         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ Network (WebSocket)
        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Frontend (Display)                          â”‚
â”‚                                                              â”‚
â”‚  Receive Message                                             â”‚
â”‚       â”‚                                                      â”‚
â”‚       â–¼                                                      â”‚
â”‚  Update UI                                                   â”‚
â”‚       â”‚ (Show transcribed text)                             â”‚
â”‚       â–¼                                                      â”‚
â”‚  Fill Text Area / Pass to Decision System                   â”‚
â”‚       â”‚                                                      â”‚
â”‚       â–¼                                                      â”‚
â”‚  Ready for Next Step âœ“                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Caching System

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Transcription Cache                         â”‚
â”‚                                                          â”‚
â”‚  Audio Input                                             â”‚
â”‚      â”‚                                                   â”‚
â”‚      â–¼                                                   â”‚
â”‚  Calculate MD5 Hash                                      â”‚
â”‚      â”‚                                                   â”‚
â”‚      â”œâ”€â†’ Hash matches existing cache entry?             â”‚
â”‚      â”‚       â””â”€â†’ YES: Return cached text (<1s)          â”‚
â”‚      â”‚                                                   â”‚
â”‚      â””â”€â†’ NO: Run full transcription (5-10s)             â”‚
â”‚              â”‚                                          â”‚
â”‚              â–¼                                          â”‚
â”‚          Get Transcribed Text                           â”‚
â”‚              â”‚                                          â”‚
â”‚              â–¼                                          â”‚
â”‚          Store in Cache                                 â”‚
â”‚              â”‚                                          â”‚
â”‚              â”‚  {hash: "a1b2c3..." â†’ "Hello world"}    â”‚
â”‚              â”‚                                          â”‚
â”‚              â–¼                                          â”‚
â”‚          Return Result                                  â”‚
â”‚                                                          â”‚
â”‚  Benefits:                                               â”‚
â”‚  âœ“ Same audio recognized instantly                      â”‚
â”‚  âœ“ Reduces computation time                             â”‚
â”‚  âœ“ Improves user experience                             â”‚
â”‚  âœ“ Works within single session                          â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## WebSocket Message Protocol

### Client â†’ Server: Audio Chunk

```json
{
  "type": "audio",
  "data": "base64_encoded_audio_data_here...",
  "language": "en"
}
```

### Server â†’ Client: Acknowledgment

```json
{
  "type": "ack",
  "bytes_received": 4096,
  "total_bytes": 32768
}
```

### Client â†’ Server: Trigger Transcription

```json
{
  "type": "transcribe"
}
```

### Server â†’ Client: Transcription Result

```json
{
  "type": "transcription",
  "text": "Should I leave my job to start a startup?",
  "language": "en",
  "cached": false,
  "error": null
}
```

### Client â†’ Server: Trigger Decision

```json
{
  "type": "DECIDE"
}
```

### Server â†’ Client: Transcribed (in decide flow)

```json
{
  "type": "transcribed",
  "text": "Should I leave my job?",
  "language": "en"
}
```

### Server â†’ Client: Agent Response

```json
{
  "type": "agent_response",
  "agent": "ethical",
  "output": "From an ethical standpoint, leaving your job to pursue your startup could be justified if..."
}
```

### Server â†’ Client: Final Decision

```json
{
  "type": "final_decision",
  "decision": "After carefully considering all perspectives...",
  "complete": true
}
```

### Server â†’ Client: Error

```json
{
  "type": "error",
  "message": "Failed to transcribe audio: microphone device not found"
}
```

---

## Performance Timeline

### First Use (Model Download)

```
Time: 0s      - App starts
Time: 5s      - User clicks "Start Recording"
Time: 15s     - User stops recording
Time: 20s     - User clicks "Transcribe"
Time: 20-25s  - Whisper model downloading (~140MB)
Time: 90-120s - Model loaded and cached
Time: 125s    - Transcription complete âœ“
```

### Subsequent Use (Model Cached)

```
Time: 0s      - User clicks "Start Recording"
Time: 10s     - User stops recording
Time: 12s     - User clicks "Transcribe"
Time: 17-22s  - Transcription complete âœ“ (Model already loaded)
```

### Cache Hit (Same Audio)

```
Time: 0s      - User clicks "Start Recording"
Time: 10s     - User stops recording
Time: 12s     - User clicks "Transcribe"
Time: 12-13s  - Cache lookup âœ“
Time: 13s     - Result returned instantly âœ“
```

---

## Error Handling Flow

```
User Action
    â”‚
    â–¼
Try-Catch Block
    â”‚
    â”œâ”€â†’ Microphone Access Error
    â”‚       â””â”€â†’ "Permission denied - allow microphone access"
    â”‚
    â”œâ”€â†’ WebSocket Connection Error
    â”‚       â””â”€â†’ "Cannot connect to backend - is server running?"
    â”‚
    â”œâ”€â†’ Empty Audio Error
    â”‚       â””â”€â†’ "No audio recorded - try recording again"
    â”‚
    â”œâ”€â†’ Whisper Model Error
    â”‚       â””â”€â†’ "Transcription failed - try again"
    â”‚
    â”œâ”€â†’ Network Error
    â”‚       â””â”€â†’ "Connection lost - check internet"
    â”‚
    â””â”€â†’ Timeout Error
            â””â”€â†’ "Request timeout - audio too long?"
    â”‚
    â–¼
Display Error Message (Red Box)
    â”‚
    â–¼
User Can Retry
```

---

This comprehensive visualization helps understand how the audio system integrates with your Synapse Council! ğŸ¤âœ¨
