# Synapse Council Architecture - On-Demand Integration

## System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     USER INTERFACE                              â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Decision     â”‚  â”‚ Counsellor   â”‚  â”‚ Multimodal Input     â”‚  â”‚
â”‚  â”‚ Input Form   â”‚  â”‚ Chat Panel   â”‚  â”‚ (Voice/Images)       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚              React Frontend (localhost:3000)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â”‚ HTTP/JSON
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    BACKEND (FastAPI)                            â”‚
â”‚                  (localhost:8000)                               â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  API Routes                                              â”‚  â”‚
â”‚  â”‚  âœ“ POST /api/decide              (Council debate)       â”‚  â”‚
â”‚  â”‚  âœ“ POST /api/counsellor/chat     (Session chat)         â”‚  â”‚
â”‚  â”‚  âœ“ POST /api/transcribe          (Audio â†’ Text)         â”‚  â”‚
â”‚  â”‚  âœ“ POST /api/upload-image        (Image analysis)       â”‚  â”‚
â”‚  â”‚  âœ“ GET  /health                  (Health check)         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Core Components                                         â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â”‚  orchestrator.py                                         â”‚  â”‚
â”‚  â”‚  â”œâ”€ Manages multi-agent debate                          â”‚  â”‚
â”‚  â”‚  â”œâ”€ Routes to specialized agents                        â”‚  â”‚
â”‚  â”‚  â””â”€ Aggregates recommendations                          â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â”‚  counsellor.py                                           â”‚  â”‚
â”‚  â”‚  â”œâ”€ Session-aware conversation                          â”‚  â”‚
â”‚  â”‚  â”œâ”€ Memory management                                   â”‚  â”‚
â”‚  â”‚  â””â”€ Uses On-Demand GPT                                  â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â”‚  multimodal.py                                           â”‚  â”‚
â”‚  â”‚  â”œâ”€ Audio transcription via On-Demand                   â”‚  â”‚
â”‚  â”‚  â””â”€ Image analysis via On-Demand vision                 â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â”‚  config.py                                               â”‚  â”‚
â”‚  â”‚  â””â”€ Unified configuration management                    â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Agent Framework                                         â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â”‚  agents/base.py                                          â”‚  â”‚
â”‚  â”‚  â”œâ”€ EQ Advocate        (Emotional intelligence)          â”‚  â”‚
â”‚  â”‚  â”œâ”€ Values Guard       (Personal values alignment)       â”‚  â”‚
â”‚  â”‚  â”œâ”€ Risk Logic         (Risk analysis)                   â”‚  â”‚
â”‚  â”‚  â”œâ”€ Red Team           (Devil's advocate)                â”‚  â”‚
â”‚  â”‚  â”œâ”€ Gita Guide         (Dharmic wisdom) â† NEW!          â”‚  â”‚
â”‚  â”‚  â””â”€ Head Council       (Final verdict)                   â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ON-DEMAND CLIENT (ondemand_client.py) â† NEW!           â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â”‚  Unified interface for all On-Demand services:           â”‚  â”‚
â”‚  â”‚  â€¢ Session management                                   â”‚  â”‚
â”‚  â”‚  â€¢ Chat with structured responses                       â”‚  â”‚
â”‚  â”‚  â€¢ Audio transcription                                  â”‚  â”‚
â”‚  â”‚  â€¢ Image analysis                                       â”‚  â”‚
â”‚  â”‚  â€¢ Conflict resolution                                  â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â”‚ HTTPS / API Key Authentication
                     â”‚ (ON_DEMAND_API_KEY from .env)
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           ON-DEMAND CLOUD PLATFORM                              â”‚
â”‚         https://api.on-demand.io                                â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Available AI Agents                                     â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â”‚  ðŸ¤– GPT Models                                           â”‚  â”‚
â”‚  â”‚     â€¢ predefined-openai-gpt4o (Primary LLM)            â”‚  â”‚
â”‚  â”‚     â€¢ Used for: Decision analysis, debate, reasoning   â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â”‚  ðŸ™ Bhagavad Gita Guide                                 â”‚  â”‚
â”‚  â”‚     â€¢ gita-guide (Dharmic wisdom agent)                 â”‚  â”‚
â”‚  â”‚     â€¢ Returns: Shlokas, dharma analysis, karma insights â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â”‚  ðŸŽ¤ Audio Agent                                          â”‚  â”‚
â”‚  â”‚     â€¢ audio-transcription                               â”‚  â”‚
â”‚  â”‚     â€¢ Converts: Voice â†’ Text                            â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â”‚  ðŸ‘ï¸  Vision Agent                                       â”‚  â”‚
â”‚  â”‚     â€¢ vision-analyzer                                   â”‚  â”‚
â”‚  â”‚     â€¢ Analyzes: Images, documents, charts               â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â”‚  âš”ï¸  Conflict Resolver                                  â”‚  â”‚
â”‚  â”‚     â€¢ conflict-analyzer                                 â”‚  â”‚
â”‚  â”‚     â€¢ Resolves: Perspective conflicts, debates          â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â”‚  + Custom agents (as configured)                        â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Session Management                                     â”‚  â”‚
â”‚  â”‚  â€¢ Creates isolated chat sessions per request           â”‚  â”‚
â”‚  â”‚  â€¢ Maintains context across queries                     â”‚  â”‚
â”‚  â”‚  â€¢ Returns structured JSON responses                    â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â–²
                     â”‚
                     â”‚ API Responses
                     â”‚ (JSON/Streaming)
                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Data Flow Example                                â”‚
â”‚                                                               â”‚
â”‚  USER INPUT:                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ "Should I change careers? I have 10 years in finance  â”‚â”‚
â”‚  â”‚  but want to explore technology"                       â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                      â”‚                                        â”‚
â”‚                      â–¼                                        â”‚
â”‚  BACKEND PROCESSES:                                          â”‚
â”‚  1. Parse dilemma (GPT Agent)                               â”‚
â”‚  2. Debate Starts:                                          â”‚
â”‚     â”œâ”€ EQ Advocate: emotional perspective                  â”‚
â”‚     â”œâ”€ Values Guard: personal values alignment             â”‚
â”‚     â”œâ”€ Risk Logic: financial risk analysis                 â”‚
â”‚     â”œâ”€ Red Team: counter-arguments                         â”‚
â”‚     â””â”€ Gita Guide: dharmic duty considerations            â”‚
â”‚  3. Head Council synthesizes all views                      â”‚
â”‚  4. Counsellor: remembers for future reference             â”‚
â”‚                      â”‚                                        â”‚
â”‚                      â–¼                                        â”‚
â”‚  API RESPONSE:                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ {                                                       â”‚â”‚
â”‚  â”‚   "final_recommendation": "PROCEED with caution",      â”‚â”‚
â”‚  â”‚   "confidence_score": 0.72,                            â”‚â”‚
â”‚  â”‚   "agent_responses": {                                 â”‚â”‚
â”‚  â”‚     "Gita Guide": {                                    â”‚â”‚
â”‚  â”‚       "recommendation": "PROCEED",                     â”‚â”‚
â”‚  â”‚       "relevant_shlokas": "2:47 - Karmanya...",       â”‚â”‚
â”‚  â”‚       "dharma_analysis": "Your svadharma...",        â”‚â”‚
â”‚  â”‚       "core_teaching": "The Gita teaches..."         â”‚â”‚
â”‚  â”‚     },                                                 â”‚â”‚
â”‚  â”‚     "Risk Logic": {...},                              â”‚â”‚
â”‚  â”‚     ...                                                â”‚â”‚
â”‚  â”‚   }                                                     â”‚â”‚
â”‚  â”‚ }                                                       â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                      â”‚                                        â”‚
â”‚                      â–¼                                        â”‚
â”‚  FRONTEND DISPLAYS:                                          â”‚
â”‚  â€¢ Council debate results                                   â”‚
â”‚  â€¢ Gita wisdom card                                         â”‚
â”‚  â€¢ Risk assessment                                          â”‚
â”‚  â€¢ Final recommendation                                     â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Models

### Decision Request Flow
```
User Input
    â†“
DecisionRequest {
    dilemma: str
    context?: str
    weights?: DecisionWeights
    user_api_key?: str
    session_id?: str
}
    â†“
Orchestrator.deliberate()
    â”œâ”€ Parse with GPT
    â”œâ”€ Get agent perspectives
    â”œâ”€ Facilitate debate
    â””â”€ Synthesize verdict
    â†“
RecommendationResponse {
    final_recommendation: str
    confidence_score: float
    reasoning: str
    agent_responses: {
        agent_name: AgentResponse {
            recommendation: str
            confidence_score: float
            reasoning: str
        }
    }
}
```

### Gita Guide Response
```
GitaResponse {
    recommendation: "PROCEED" | "CAUTION" | "BLOCK"
    confidence_score: float
    reasoning: str
    relevant_shlokas: str          # e.g., "2:47 - Karmanya va..."
    dharma_analysis: str           # How it aligns with duty
    karma_implications: str        # Consequences & spiritual impact
    core_teaching: str             # Essential Gita lesson
}
```

## Configuration Flow

```
.env file
    â”‚
    â”œâ”€ LLM_PROVIDER=ondemand
    â”œâ”€ ON_DEMAND_API_KEY=xxx
    â”œâ”€ ON_DEMAND_BASE_URL=https://api.on-demand.io
    â””â”€ ON_DEMAND_*_AGENT=agent_ids
        â”‚
        â–¼
    config.py (get_settings())
        â”‚
        â”œâ”€ Validates API key exists
        â”œâ”€ Sets agent IDs
        â””â”€ Raises error if misconfigured
        â”‚
        â–¼
    OnDemandClient.__init__()
        â”‚
        â”œâ”€ Stores API key
        â”œâ”€ Sets base URL
        â””â”€ Ready for requests
        â”‚
        â–¼
    Components use client
        â”œâ”€ counsellor.py
        â”œâ”€ multimodal.py
        â”œâ”€ agents/gita_guide.py
        â””â”€ orchestrator.py
```

## Deployment Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Client Browser (any location)                              â”‚
â”‚  â€¢ React frontend                                           â”‚
â”‚  â€¢ WebSocket/HTTP client                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â”‚ HTTPS
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Your Server (on-premise or cloud)                          â”‚
â”‚  â€¢ FastAPI backend                                          â”‚
â”‚  â€¢ Session memory (file/DB)                                 â”‚
â”‚  â€¢ .env with ON_DEMAND_API_KEY                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â”‚ HTTPS + API Key Auth
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  On-Demand Cloud Platform (on-demand.io)                    â”‚
â”‚  â€¢ GPT Models                                               â”‚
â”‚  â€¢ Gita Wisdom Agent                                        â”‚
â”‚  â€¢ Audio/Vision Processing                                  â”‚
â”‚  â€¢ Multi-tenant infrastructure                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Security Model

```
Request Flow:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. User sends request from browser     â”‚
â”‚    (NO API key in request)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Backend receives request            â”‚
â”‚    â€¢ Validates user session            â”‚
â”‚    â€¢ Loads ON_DEMAND_API_KEY from .env â”‚
â”‚    â€¢ (API key NEVER sent to frontend)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Backend authenticates with On-Demandâ”‚
â”‚    â€¢ Includes ON_DEMAND_API_KEY        â”‚
â”‚    â€¢ HTTPS encrypted                   â”‚
â”‚    â€¢ Session-based requests            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. On-Demand processes request         â”‚
â”‚    â€¢ Returns structured response       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. Backend sends result to frontend    â”‚
â”‚    (API key removed from response)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Component Interaction

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ orchestrator.py                                     â”‚
â”‚                                                     â”‚
â”‚  deliberate(dilemma, context)                       â”‚
â”‚  â”œâ”€ 1. Parse with GPT Agent                        â”‚
â”‚  â”œâ”€ 2. Generate agent perspectives:                â”‚
â”‚  â”‚   â”œâ”€ EQ Advocate                               â”‚
â”‚  â”‚   â”œâ”€ Values Guard                              â”‚
â”‚  â”‚   â”œâ”€ Risk Logic                                â”‚
â”‚  â”‚   â”œâ”€ Red Team                                  â”‚
â”‚  â”‚   â”œâ”€ Gita Guide â† Uses On-Demand              â”‚
â”‚  â”‚   â””â”€ Head Council                              â”‚
â”‚  â”œâ”€ 3. Facilitate debate if conflict > threshold   â”‚
â”‚  â””â”€ 4. Return synthesized recommendation           â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€ Uses: OnDemandClient
         â”œâ”€ Uses: agents/*.py
         â”œâ”€ Uses: memory.py
         â””â”€ Uses: config.py
```

## Summary

The new On-Demand integration provides:

1. **Unified Platform**: One API key for multiple services
2. **Specialized Agents**: Gita, GPT, Audio, Vision all in one place
3. **Better Architecture**: Clean separation via `OnDemandClient`
4. **Scalability**: Cloud-based processing
5. **Dharmic Wisdom**: Dedicated Bhagavad Gita guidance
6. **Backward Compatible**: Can switch back to Ollama if needed

All components are production-ready and have been syntax-validated! ðŸš€
